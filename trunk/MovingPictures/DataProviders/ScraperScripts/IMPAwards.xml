<ScriptableScraper>
  <details>
    <!-- These details are for display purposes only. -->
    <name>IMPAwards</name>
    <author>John Conrad (fforde)</author>
    <description>This script grabs cover-art from impawards.com.</description>

    <!-- 
    These two fields uniquely identify the script. The ID should never 
    change and should be unique (no other script should use this ID). With
    new versions of the script the version numbers should change. EVEN FOR 
    MINOR CHANGES, you should change the version number if you are going to
    disribute it to anyone but internal testers. The point number 
    is for minor bug fix releases. Use it.
    -->
    <id>874903</id>
    <version major="0" minor="8" point="0"/>
    
    <!--
    These fields are used for categorization purposes. Seperate multiple 
    types with a pipe | character.
    -->
    <type>MovieCoverFetcher</type>
    <language>English</language>

    <!-- If set to true, additional logging will be displayed during script execution. -->
    <debug>false</debug>
   </details>
  
  
  <action name="get_cover_art">
    <retrieve name="year_page" url="http://www.impawards.com/${movie.year}/standard.html" />
    <parse name="movies" input="${year_page}" regex="&lt;td&gt;&lt;font size=\+1&gt;([^&lt;]+).+?&lt;/tr&gt;"/>
    
    <!-- loop through all movies of this year and create distance values from the title for each -->
    <loop name="curr_movie" on="movies" limit="5000">
      <distance name='movies[${count}].distance' string1='${movie.title}' string2='${curr_movie[0]}'/>
    </loop>

    <!-- 
    sort our possible covers by match then check if the first 5 closest matches to see if any
    are the one we are looking for 
    -->
    <sort name='movies' by='distance'/>
    
    <!-- ok i lied, for now just use the first result. conditional logic is comining tomorrow. :P -->
    <parse name="covers" input="${movies[0]}" regex='&lt;A HREF = "([^"]+)"&gt;'/>
    <loop name='cover_url' on='covers'>
      <retrieve name='cover_page' url='http://www.impawards.com/${movie.year}/${cover_url[0]}'/>
      <parse name='cover_img_url' input='${cover_page}' regex='&lt;img SRC="([^"]+)" ALT = "Movie Poster Image for'/>
      <!-- armand, you were up far too late last night... o.O -->
      <set name='cover_art[${count}].url' value='http://www.impawards.com/${movie.year}/${cover_img_url[0][0]}'/>
    </loop>
    
  </action>
</ScriptableScraper>